<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="css/styles.css" />
  <script type="module" src="dist/index.js" canvas="myCanvas"></script>
</head>

<body>
  <button class="openbtn" onclick="openNav()">☰ Open Sidebar</button>
  <div class="canvas-container">
    <canvas id="myCanvas" resize></canvas>
  </div>
</body>

<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
  <form id="configForm">
    <div>
      <label for="width">Width</label>
      <input type="number" id="width" name="width" min="1" max="255" value="8">
      <label for="height">Height</label>
      <input type="number" id="height" name="height" min="1" max="1000" value="1">
      <label for="initialConfig">Initial Configuration</label>
      <input type="text" id="initialConfig" name="initialConfig" value="1,0,1,0,1,0,1,0">
    </div>
    <input type="submit" value="Submit">
  </form>
  <div>
    <label for="neighborhoodSelect">Neighborhood Type:
      <select id="neighborhoodSelect" name="neighborhoodSelect" onchange="handleNeighborhoodChange()">
      </select>
    </label>
  </div>
  <div>
    <label for="ruleSelect">Rule:
      <select id="ruleSelect" name="ruleSelect" onchange="handleRuleChange()">
      </select>
    </label>
  </div>
  <div>
    <label for="tickRate"> Tick Rate (hz)
      <input type="number" id="tickRate" name="tickRate" min="0" max="255" value="60">
    </label>
    <label for="stop"> STOP
      <input type="checkbox" id="stopButton" name='stop' value="false">
    </label>
  </div>
</div>

<script>
  function openNav() {
    document.getElementById("mySidebar").style.width = "250px";
    document.getElementById("myCanvas").style.marginLeft = "250px";
  }

  function closeNav() {
    document.getElementById("mySidebar").style.width = "0";
    document.getElementById("myCanvas").style.marginLeft = "0";
  }

  /**
   * Initialize neighborhood dropdown from available neighborhoods
   */
  function initializeNeighborhoodSelect() {
    const neighborhoodSelect = document.getElementById("neighborhoodSelect");
    if (!window.getAvailableNeighborhoods) return;
    
    const neighborhoods = window.getAvailableNeighborhoods();
    neighborhoods.forEach(({type, label}) => {
      const option = document.createElement('option');
      option.value = type;
      option.textContent = label;
      neighborhoodSelect.appendChild(option);
    });
    
    // Initialize rules for the default neighborhood
    if (neighborhoods.length > 0) {
      initializeRuleSelect(neighborhoods[0].type);
    }
  }

  /**
   * Initialize rule dropdown for a given neighborhood type
   */
  function initializeRuleSelect(neighborhoodType) {
    const ruleSelect = document.getElementById("ruleSelect");
    if (!window.getAvailableRulesForNeighborhood) return;
    
    ruleSelect.innerHTML = '';
    const rules = window.getAvailableRulesForNeighborhood(neighborhoodType);
    rules.forEach(({key, label}) => {
      const option = document.createElement('option');
      option.value = key;
      option.textContent = label;
      ruleSelect.appendChild(option);
    });
  }

  function handleNeighborhoodChange() {
    const neighborhoodSelect = document.getElementById("neighborhoodSelect");
    initializeRuleSelect(neighborhoodSelect.value);
    if (window.switchNeighborhoodType) {
      window.switchNeighborhoodType(neighborhoodSelect.value);
    }
  }

  function handleRuleChange() {
    const ruleSelect = document.getElementById("ruleSelect");
    if (window.switchRule) {
      window.switchRule(ruleSelect.value);
    }
  }
</script>

</html>